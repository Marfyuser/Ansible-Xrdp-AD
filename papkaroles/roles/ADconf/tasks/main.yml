---
- name: r.conf
  lineinfile:
    dest: /etc/resolv.conf
    insertafter: '# Generated by NetworkManager'
    regexp: '{{ item.reg }}'
    state: absent
  with_items:
    - { reg: '^search' }
    - { reg: '^nameserver' }

- name: resolv.conf
  ansible.builtin.blockinfile:
    dest: /etc/resolv.conf
    insertafter: '# Generated by NetworkManager'
    block: |
      search {{ domain }}
      nameserver {{ ip }}

- name: conf comm
  replace:
    dest: /etc/chrony.conf
    regexp: '^server'
    replace: '#server'

- name: conf add str
  lineinfile:
    dest: /etc/chrony.conf
    insertafter: '# These servers were defined in the installation:'
    line: 'server {{ FQDNnameDomain }} iburst'
    state: present

- name: change hostname
  shell: hostnamectl set-hostname {{ pcname }}.{{ domain }}

- name: ad string etc\hosts
  ansible.builtin.lineinfile:
    dest: /etc/hosts
    line: '127.0.0.1 {{ pcname }}.{{ domain }}'
    insertafter: EOF

